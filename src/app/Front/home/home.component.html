<div class="container">
  <!-- Formulaire de création de post -->
  <div class="post-form">
    <form [formGroup]="postForm" (ngSubmit)="addPost()">
      <div class="form-group">
        <label for="content">Add Post :</label>
        <textarea formControlName="content" id="content" name="content" class="form-control" rows="4"></textarea>
        <div *ngIf="postForm.get('content')?.invalid && (postForm.get('content')?.dirty || postForm.get('content')?.touched)" class="text-danger">
          Le contenu du post est requis.
        </div>
      </div>
      <button type="submit" [disabled]="postForm.invalid" class="btn btn-primary">Poster</button>
    </form>
  </div>

  <!-- Liste des Posts -->
  <div *ngIf="posts?.length > 0" class="mt-5">
    <div class="row">
      <nz-list nzItemLayout="vertical">
        <nz-list-item *ngFor="let post of posts" class="d-block">
          <div class="d-flex justify-content-between">

            <nz-list-item-meta>
              <nz-list-item-meta-avatar [nzSrc]="'https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png'"></nz-list-item-meta-avatar>
              <nz-list-item-meta-title >
                <a href="#">{{ post.student.name }}</a>
              </nz-list-item-meta-title>
            </nz-list-item-meta>
            <div class="d-flex align-items-center gap-4">
              <a   [routerLink]="['/modify', post.id]" nz-button nzType="text" nzDanger class="link-info capitalize">modifier</a>
              <a (click)="deletePost(post.id)" nz-button nzType="text" nzDanger class="link-red capitalize">supprimer</a>
            </div>

          </div>
          <p>
            {{ post.content }}
          </p>

          <form [formGroup]="createCommentForm" (ngSubmit)="addComment(post.id)">
            <nz-comment>
              <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="'https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png'"></nz-avatar>
              <nz-comment-content>
                <nz-form-item>
                  <textarea formControlName="comment" id="comment" name="comment" class="form-control" rows="2" placeholder="Ajouter un commentaire"></textarea>
                  <div *ngIf="createCommentForm.get('comment')?.invalid && (createCommentForm.get('comment')?.dirty || createCommentForm.get('comment')?.touched)" class="text-danger">
                    Le contenu du commentaire est requis.
                  </div>
                </nz-form-item>
                <nz-form-item>

                  <button  nz-button nzType="primary" type="submit" [disabled]="createCommentForm.invalid" class="btn btn-primary">Commenter</button>
                </nz-form-item>
              </nz-comment-content>
            </nz-comment>
          </form>

          <h6 class="text-muted">Comments :</h6>
          <nz-list [nzDataSource]="post.comments" [nzRenderItem]="item" [nzItemLayout]="'vertical'" class="ml-30">
            <ng-template #item let-item>
              <nz-comment [nzAuthor]="item.author" [nzDatetime]="post.student.name">
                <nz-avatar nz-comment-avatar nzIcon="user" [nzSrc]="'https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png'"></nz-avatar>
                <nz-comment-content>
                  <p>{{ item.content }}</p>
                </nz-comment-content>
              </nz-comment>
            </ng-template>
          </nz-list>
        </nz-list-item>
      </nz-list>
       </div>
  </div>

  <!-- Aucun post trouvé -->
  <div *ngIf="posts?.length === 0" class="mt-5">
    <p class="text-center">Aucun post trouvé.</p>
  </div>
</div>
